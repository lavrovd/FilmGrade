CUDAPATH = /usr/local/cuda
NVCC = ${CUDAPATH}/bin/nvcc
CXXFLAGS = -I../OpenFX-1.3/include -I../Support/include -I/usr/local/cuda/include -fPIC
OPTIMIZER = -g

FilmGradePlugin.ofx: FilmGradePlugin.o CudaKernel.o OpenCLKernel.o ofxsCore.o ofxsImageEffect.o ofxsInteract.o ofxsLog.o ofxsMultiThread.o ofxsParams.o ofxsProperty.o ofxsPropertyValidation.o
	$(CXX) -shared $^ -o $@ -L ${CUDAPATH}/lib64 -lcuda -lcudart
	mkdir -p FilmGradePlugin.ofx.bundle/Contents/Linux-x86-64/
	cp FilmGradePlugin.ofx FilmGradePlugin.ofx.bundle/Contents/Linux-x86-64/
	mkdir -p FilmGradePlugin.ofx.bundle/Contents/Resources/
	cp OpenFX.Yo.FilmGrade.png FilmGradePlugin.ofx.bundle/Contents/Resources/
	rm *.o *.ofx

CudaKernel.o: CudaKernel.cu
	${NVCC} --compiler-options="-fPIC" -c $<

%.o: ../Support/Library/%.cpp
	$(CXX) -c $< $(CXXFLAGS)

clean:
	rm -f *.o *.ofx
	rm -fr FilmGradePlugin.ofx.bundle